<!DOCTYPE html>
<html lang="en-US">

<head>
  <title>Web Chat: Avatar with images and initials</title>
  <!--
        https://stackoverflow.com/questions/54257379/pass-custom-parameters-from-webchat-control-to-bot-framework
    https://stackoverflow.com/questions/52498711/how-to-create-be-languages-bot-in-direct-line-channel  
      For demonstration purposes, we are using the development branch of Web Chat at "/master/webchat.js".
      When you are using Web Chat for production, you should use the latest stable release at "/latest/webchat.js",
      or lock down on a specific version with the following format: "/4.1.0/webchat.js".
    -->
  <script src="https://cdn.botframework.com/botframework-webchat/master/webchat.js"></script>
  <style>
    html,
    body {
      background-color: #1d0303;
      height: 100%
    }

    body {
      margin-left: 10
    }

    #webchat {
      height: 100%;
      width: 40%;
    }
  </style>
</head>

<body>
  <div id="webchat" role="main"></div>
  <script>
    (async function () {
      // https://docs.microsoft.com/en-us/azure/bot-service/rest-api/bot-framework-rest-direct-line-3-0-authentication

      const res = await fetch('https://directline.botframework.com/v3/directline/tokens/generate',
        {
          method: 'POST',
          headers: { "Authorization": "Bearer 776bhqI6tBc.tWoh0POEv9jUPfO_-dgYJi_7VEsJLdSYaLAzsn5suJ0" }
        });
      // const { token } = await res.json();
      const { token } = await res.json();
      //https://github.com/Microsoft/BotFramework-WebChat/blob/master/packages/component/src/Styles/defaultStyleSetOptions.js
      const styleSet = window.WebChat.createStyleSet({
        backgroundColor: 'White',
        botAvatarImage: './bot2.jpg',
        botAvatarInitials: 'VW',
        userAvatarImage: './man4.jpg',
        userAvatarInitials: 'WC',
        bubbleBackground: 'rgba(0, 0, 255, .1)',
        bubbleFromUserBackground: 'rgba(0, 255, 0, .1)'
      });

      styleSet.textContent = {
        ...styleSet.textContent,
        fontFamily: '\'Comic Sans MS\', \'Arial\', sans-serif',
        fontWeight: 'bold'
      };

      // console.log(token)
      /*
      {
        "conversationId": "ARzPrguXoYs8Dxyoz8uTEu",
        "token": "2e8CBc57Gr0.dAA.QQBSAHoAUAByAGcAdQBYAG8AWQBzADgARAB4AHkAbwB6ADgAdQBUAEUAdQA.R0E0VArI1AE.skdtzEi7xmM.MOLmRTF8aSNG-8Y3QgGAQwNzXb2Ff1sEwydTc-xutnQ",
        "expires_in": 1800
      }
      */

      // zeige mir eine liste von h1h1 autos
      // wieviele fahrzeuge davon haben 5 sitze und ein svl getriebe?
      // wieviele a2a2 fahrzeuge mit einem t9 dach und einem tbr getriebe und dem model 8w gibt es?
      const localeLanguage = navigator.language;
      console.log(localeLanguage);

      var dl = window.WebChat.createDirectLine({ secret: token });
      var botContainer = document.getElementById('webchat');

      window.WebChat.renderWebChat({ directLine: dl, styleSet, webSpeechPonyfillFactory: window.WebChat.createBrowserWebSpeechPonyfillFactory() }, botContainer);

      var activity = {
        from: {
          id: "User",
          name: "userName"
        },
        name: 'startConversation',
        type: 'event',
        value: '',
        channelData: {
          "personId": "user",
          "environment": window.location.host,
          "param1": localeLanguage
        }
      };

      dl.postActivity(activity).subscribe(function (id) {
        if (console) {
          console.log('"trigger requestWelcomeDialog" sent');
        }
      });

    })().catch(err => console.error(err));
  </script>
</body>

</html>